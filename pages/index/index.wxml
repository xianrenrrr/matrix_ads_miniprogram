<!-- pages/index/index.wxml -->
<view class="page-container">
  <!-- 头部 -->
  <view class="header">
    <text class="header-title">Glow AI</text>
  </view>

  <!-- 加载状态 -->
  <view wx:if="{{loading}}" class="loading">
    <view class="loading-spinner"></view>
  </view>

  <!-- 主要内容 -->
  <view wx:else class="container">
    <!-- 欢迎信息 -->
    <view class="card card-flush full-bleed">
      <view>
        <view class="greeting-box">
          <view class="title-row">
            <image class="greeting-pin" src="/assets/Frame@2x.png" mode="aspectFit" />
            <view class="title-texts">
              <view class="card-title home-title">您好！{{userInfo.username || '用户'}}</view>
              <view class="card-subtitle home-subtitle">开始今天的创作吧!</view>
              <image class="greeting-illustration" src="/assets/Mask group@3x.png" mode="aspectFit" />
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- 统计数据（三列对齐到大矩形左右边） -->
    <view class="stats-layer full-bleed">
      <view class="mini-stat-card">
        <view class="stat-number stat-number-box {{availableDigitClass}} text-primary">{{stats.availableTemplates}}</view>
        <view class="stat-label">可用模板</view>
        <image class="stat-icon stat-icon-1" src="/assets/Group 8935@2x copy 2.png" mode="aspectFit" />
      </view>
      <view class="mini-stat-card">
        <view class="stat-number stat-number-box {{recordedDigitClass}} text-success">{{stats.recordedVideos}}</view>
        <view class="stat-label">已录制</view>
        <image class="stat-icon stat-icon-2" src="/assets/Group 8935@2x.png" mode="aspectFit" />
      </view>
      <view class="mini-stat-card">
        <view class="stat-number stat-number-box {{publishedDigitClass}} text-warning">{{stats.publishedVideos}}</view>
        <view class="stat-label">已发布</view>
        <image class="stat-icon stat-icon-3" src="/assets/Group 8935@2x copy.png" mode="aspectFit" />
      </view>
    </view>

    <!-- 全部模版 标题（非盒子） -->
    <text class="all-templates-link">全部模版</text>

    <!-- 全部模版 列表 -->
    <view wx:if="{{allTemplates.length}}" class="tpl-grid full-bleed">
      <view
        wx:for="{{allTemplates}}"
        wx:key="id"
        class="tpl-card"
        data-id="{{item.id}}"
        bindtap="selectTemplate"
      >
        <view class="tpl-thumb">
          <image src="{{item.thumbnail || '/assets/default-template.jpg'}}" mode="aspectFill" class="tpl-thumb-img" />
        </view>
        <view class="tpl-title {{item._titleClass}}">{{item.templateTitle || '未命名模板'}}</view>
        <view class="tpl-meta">
          <view class="meta-item"><text class="meta-dot"></text><text>场景{{item.sceneCount || 0}}</text></view>
          <view class="meta-item"><text class="meta-dot"></text><text>{{item.duration || 0}}秒</text></view>
        </view>
        <view class="tpl-actions">
          <view class="record-btn">开始录制</view>
        </view>
      </view>
    </view>

    <!-- 退出登录 CTA -->
    <view class="logout-cta" bindtap="handleLogout">退出登录</view>
  </view>
</view>
