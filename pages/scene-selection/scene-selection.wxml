<!--pages/scene-selection/scene-selection.wxml-->
<view class="scene-selection-container">

  <!-- Loading State -->
  <view class="loading-container" wx:if="{{loading}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">加载场景中...</text>
  </view>

  <!-- Template Info -->
  <view class="template-info" wx:if="{{!loading && template}}">
    <view class="info-card">
      <text class="info-title">模板说明</text>
      <text class="info-description">{{template.templateDescription || '请按照具体说明录制每个场景'}}</text>
    </view>
  </view>

  <!-- Scenes List -->
  <view class="scenes-container" wx:if="{{!loading}}">
    <view class="scenes-header">
      <text class="scenes-title">场景</text>
      <text class="scenes-subtitle">点击"录制"开始拍摄每个场景</text>
    </view>

    <view class="scenes-list">
      <view wx:for="{{scenes}}" wx:key="index" class="scene-item">
        <!-- Scene Header -->
        <view class="scene-header">
          <view class="scene-number-container">
            <view class="scene-number" 
                  style="background-color: {{getSceneStatusColor(getSceneStatus(index + 1))}}">
              {{index + 1}}
            </view>
            <text class="scene-status">{{getSceneStatus(index + 1)}}</text>
          </view>
          
          <view class="scene-title-container">
            <text class="scene-title">{{item.sceneTitle || '场景 ' + (index + 1)}}</text>
          </view>
        </view>

        <!-- Scene Content -->
        <view class="scene-content" wx:if="{{submissions[index + 1]}}">
          <!-- AI Similarity Score -->
          <view class="similarity-section" wx:if="{{submissions[index + 1].similarityScore}}">
            <text class="similarity-label">AI相似度:</text>
            <text class="similarity-value {{submissions[index + 1].similarityScore >= 0.85 ? 'high-score' : ''}}">
              {{getSimilarityScore(index + 1)}}%
            </text>
            <!-- Green checkmark for high scores -->
            <text class="score-indicator" wx:if="{{submissions[index + 1].similarityScore >= 0.85}}">✓</text>
          </view>

          <!-- AI Suggestions -->
          <view class="suggestions-section" wx:if="{{submissions[index + 1].aiSuggestions && submissions[index + 1].aiSuggestions.length > 0}}">
            <text class="suggestions-label">AI建议:</text>
            <view class="suggestions-list">
              <text wx:for="{{submissions[index + 1].aiSuggestions}}" wx:key="index" class="suggestion-item">
                • {{item}}
              </text>
            </view>
          </view>
        </view>

        <!-- Scene Actions -->
        <view class="scene-actions">
          <!-- Record Button -->
          <button class="record-button {{getSceneStatus(index + 1) === 'approved' ? 'completed' : ''}}"
                  data-index="{{index}}"
                  bindtap="recordScene"
                  size="mini">
            {{getSceneStatus(index + 1) === 'approved' ? '重新录制' : 
              getSceneStatus(index + 1) === 'pending' ? '重新录制' :
              getSceneStatus(index + 1) === 'rejected' ? '修改重录' : '录制'}}
          </button>
        </view>
      </view>
    </view>
  </view>

  <!-- Overall Progress -->
  <view class="progress-summary" wx:if="{{!loading && progress}}">
    <view class="progress-card">
      <text class="progress-title">总体进度</text>
      <view class="progress-stats">
        <view class="stat-item">
          <text class="stat-number">{{progress.approved}}</text>
          <text class="stat-label">已通过</text>
        </view>
        <view class="stat-item">
          <text class="stat-number">{{progress.pending}}</text>
          <text class="stat-label">待审核</text>
        </view>
        <view class="stat-item">
          <text class="stat-number">{{Math.round(progress.completionPercentage || 0)}}%</text>
          <text class="stat-label">完成度</text>
        </view>
      </view>
    </view>
  </view>
</view>